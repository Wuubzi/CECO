---
import Navbar from "../components/Navbar.astro";
import Footer from "../components/Footer.astro";
import Layout from "../layouts/Layout.astro";
import { Image } from "astro:assets";
import heroImage from "../assets/hero-image.jpeg";
import HeadersSection from "../components/headersSection.astro";
import Cards from "../components/cards.astro";
import CardsContent from "../data/CardsContent.js";
import CardsReviews from "../components/cardsReviews.astro";
import AskCards from "../components/askCards.astro";
import CardsReviewsContent from "../data/CardsReviewsContent.js";
import PreIcfes from "../assets/pre-icfes.png";
import KRadio from "../assets/k-radio.png";
import askCardsContent from "../data/askCardsContent.js";
import exploreMoreContent from "../data/exploreMoreContent";
import ExploreMoreCards from "../components/exploreMoreCards.astro";
---

<Layout>
  <!-- Navbar Component -->
  <Navbar />
  <!-- Hero Section -->
  <section class="p-5">
    <!-- Principal Container -->
    <div
      class="flex flex-col items-center justify-center gap-5 lg:flex-row mb-10 lg:gap-20"
    >
      <!-- Image Hero -->
      <figure class="">
        <Image
          src={heroImage}
          alt="Hero Image"
          class="w-full h-full object-contain"
        />
      </figure>
      <!-- Text Container -->
      <div
        class="flex flex-col items-center justify-center text-center mt-6 gap-5 lg:w-full lg:p-10 lg:items-start"
      >
        <!-- "Header of Title" -->
        <div class="w-[90%]">
          <p class="text-lg text-start px-5 text-[#262626] font-medium">
            Bienvenidos al Colegio de Educación por Ciclos de Oriente
          </p>
          <div
            class="h-[3px] w-[85%] bg-[#262626] rounded-full mt-1 ml-5 lg:w-[72%]"
          >
          </div>
        </div>

        <!-- Title -->
        <h1
          class="text-3xl font-extrabold text-[#1A1A1A] lg:text-start lg:text-5xl"
        >
          Cultivando Conocimiento, <span class="text-[#00AEEF]"
            >Construyendo Futuros.</span
          >
        </h1>
        <p class="text-[#333333] text-lg font-medium lg:text-start lg:text-lg">
          En CECO, ofrecemos una educación integral por ciclos, adaptada a las
          necesidades de cada estudiante para impulsar su desarrollo académico y
          personal. ¡Construimos juntos un futuro lleno de oportunidades!
        </p>
        <!-- Stats Container -->
        <div
          class="border-2 w-full rounded-2xl bg-[#D9FFA1] lg:h-max lg:w-max lg:flex"
        >
          <div class="text-center p-7">
            <p class="text-4xl font-extrabold text-[#262626]">+3500</p>
            <p class="text-xl text-[#262626] font-medium">Estudiantes</p>

            <div class="mt-5 w-[70%] mx-auto h-1 bg-[#262626] lg:hidden"></div>
          </div>
          <div class="text-center p-7">
            <p class="text-4xl font-extrabold text-[#262626]">+50</p>
            <p class="text-xl text-[#262626] font-medium">
              Docentes Capacitados
            </p>

            <div class="mt-5 w-[70%] mx-auto h-1 bg-[#262626] lg:hidden"></div>
          </div>
          <div class="text-center p-7">
            <p class="text-4xl font-extrabold text-[#262626]">+15</p>
            <p class="text-xl text-[#262626] font-medium">
              Experiencia Educando
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!--  -->
  <section class="p-5">
    <div class="flex flex-col items-center justify-center gap-5 mb-10 lg:gap-8">
      <HeadersSection text="Adaptación y Flexibilidad para el Exito" />
      <div class="flex flex-col gap-3 pb-3 lg:gap-5">
        <h2 class="text-[#00AEEF] font-bold text-2xl text-center lg:text-4xl">
          La Fortaleza de Nuestro Modelo por Ciclos
        </h2>
        <p
          class="text-center font-medium text-[#333333] text-xl lg:text-lg lg:w-[60%] lg:mx-auto"
        >
          Con un equipo dedicado de educadores expertos, instalaciones de última
          generación y un plan de estudios integral por ciclos, nuestro objetivo
          es sentar bases sólidas y adaptables para el futuro y ritmo de
          aprendizaje de cada estudiante.
        </p>
      </div>
      <!-- Cards Container -->
      <div class="flex flex-col gap-15 pt-10 lg:grid lg:grid-cols-3 lg:gap-10">
        {
          CardsContent.map((card) => (
            <Cards
              title={card.title}
              description={card.description}
              icon={card.icon}
            />
          ))
        }
      </div>
    </div>
  </section>

  <!-- Voice of Success -->
  <section class="p-5">
    <!-- Principal Container -->
    <div
      class="flex flex-col text-center items-center justify-center gap-5 mb-10"
    >
      <HeadersSection text="El Reflejo de Nuestro Modelo Educativo" />
      <h2 class="font-bold text-[#1A1A1A] text-4xl lg:text-5xl">
        Voces de Éxito en CECO
      </h2>
      <p class="text-[#333333] font-medium text-md max-w-3xl lg:text-lg">
        Nuestros testimonios son un reflejo genuino del ambiente de apoyo y la
        eficacia de nuestro modelo educativo por ciclos. Expresan el impacto
        positivo en el crecimiento profesional y personal que experimentan
        nuestros estudiantes.
      </p>
    </div>

    <!-- Carousel Container -->
    <div class="relative max-w-7xl mx-auto px-4">
      <!-- Cards Container with overflow hidden -->
      <div class="overflow-hidden">
        <div
          id="carousel-track"
          class="flex transition-transform duration-500 ease-in-out gap-6"
        >
          {
            CardsReviewsContent.map((cardReview) => (
              <div class="w-full md:w-[calc(50%-12px)] lg:w-[calc(33.333%-16px)] flex-shrink-0">
                <CardsReviews
                  image={cardReview.image}
                  name={cardReview.name}
                  rating={cardReview.rating}
                  details={cardReview.details}
                />
              </div>
            ))
          }
        </div>
      </div>

      <!-- Navigation Arrows -->
      <div class="flex gap-3 mt-8 justify-center">
        <button
          id="carousel-prev"
          class="w-12 h-12 border-2 border-[#333333] rounded-lg flex items-center justify-center hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          aria-label="Anterior"
        >
          <svg
            class="w-3 h-3"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"></path>
          </svg>
        </button>
        <button
          id="carousel-next"
          class="w-12 h-12 border-2 border-[#333333] rounded-lg flex items-center justify-center hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          aria-label="Siguiente"
        >
          <svg
            class="w-3 h-3"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"></path>
          </svg>
        </button>
      </div>

      <!-- Dots Indicator -->
      <div id="carousel-dots" class="flex gap-2 justify-center mt-4"></div>
    </div>
  </section>

  <section class="p-5">
    <!-- Principal Container -->
    <div
      class="flex flex-col text-center items-center justify-center gap-5 lg:flex-row"
    >
      <figure class="w-full">
        <Image src={PreIcfes} alt="Hero Image" class="w-screen h-full" />
      </figure>
      <!-- Text Container -->
      <div
        class="flex flex-col gap-5 justify-center items-center text-center mt-6 lg:text-start lg:justify-start lg:items-start lg:w-full"
      >
        <h2 class="text-3xl text-[#1A1A1A] font-extrabold lg:text-5xl">
          Prepárate para el Icfes: <span class="text-[#00AEEF]"
            >¡Tu futuro te espera!</span
          >
        </h2>
        <p class="font-medium text-md lg:text-lg">
          En CECO te ofrecemos una preparación sólida y efectiva para el ICFES,
          con clases dinámicas y acompañamiento personalizado que fortalecen tus
          habilidades en cada área. Nuestro objetivo es ayudarte a alcanzar los
          mejores resultados y abrir nuevas oportunidades para tu futuro
          académico. ¡Prepárate con CECO y avanza con confianza!
        </p>
        <button
          class="p-4 px-8 rounded-2xl bg-[#8CC63F] text-[#262626] font-bold text-xl w-max"
          >Empieza tu Preparación</button
        >
      </div>
    </div>
  </section>

  <!-- Ask frecuently -->
  <section class="p-5">
    <!-- Principal Container -->
    <div class="flex flex-col gap-3 justify-center items-center">
      <HeadersSection text="Respuestas Esenciales para el Éxito" />
      <!-- Text Container -->
      <div class="flex flex-col gap-4 justify-center items-center text-center">
        <h2 class="text-[#1A1A1A] font-bold text-4xl lg:text-5xl">
          Preguntas Frecuentes
        </h2>
        <p class="font-medium text-lg text-[#333333] lg:text-xl lg:w-[65%]">
          Encuentra toda la información esencial que necesitas en nuestra
          sección de Preguntas Frecuentes (FAQ), diseñada para guiarte en tu
          proceso de toma de decisiones educativas.
        </p>
      </div>
      <!-- Ask Cards Container -->
      <div
        class="flex flex-col gap-5 mt-10 w-full lg:grid lg:grid-cols-2 lg:gap-7"
      >
        {
          askCardsContent.map((card) => (
            <AskCards ask={card.question} answer={card.answer} />
          ))
        }
      </div>
    </div>
    <!-- K-Radio Container -->
    <section class="p-5">
      <!-- Principal Container -->
      <div class="flex flex-col md:flex-row gap-5 justify-center items-center">
        <figure>
          <Image src={KRadio} alt="Hero Image" class="w-screen h-full" />
        </figure>
        <div
          class="flex flex-col justify-center items-center gap-3 lg:text-start lg:justify-start lg:items-start lg:w-full"
        >
          <h2 class="font-extrabold text-3xl text-[1A1A1A]">
            Sintonízate con <span class="text-[#00AEEF]">K-Radio</span>
          </h2>
          <p class="font-medium text-lg text-[#333333] text-center">
            Conéctate a K Radio y disfruta de una programación variada que
            combina música, información y contenidos para todos los gustos. Una
            señal en vivo pensada para acompañarte en cualquier momento del día.
          </p>
          <button
            class="p-4 px-8 rounded-2xl bg-[#8CC63F] text-[#262626] font-bold text-xl w-max"
            >Vibra Con K-Radio</button
          >
        </div>
      </div>
    </section>

    <!-- Explore more Section -->
    <section class="p-5">
      <!-- Principal Container -->
      <div class="flex flex-col gap-5 justify-center items-center">
        <HeadersSection text="Explora Más" />
        <div
          class="flex flex-col gap-5 justify-center items-center text-center"
        >
          <h2 class="font-bold text-3xl lg:text-5xl">
            Navega a Través de Nuestros Programas
          </h2>
          <p class="font-medium text-[#333333] text-md lg:text-lg lg:w-[60%]">
            Tu puerta de entrada para descubrir información valiosa sobre
            nuestro modelo educativo por ciclos. Siéntete libre de explorar y
            conocer la experiencia de crecimiento integral que te espera en
            CECO.
          </p>
        </div>
        <!-- Explore more Cards Container -->
        <div class="flex flex-col gap-7 pt-5 lg:grid lg:grid-cols-2 lg:gap-10">
          {
            exploreMoreContent.map((card) => (
              <ExploreMoreCards
                title={card.title}
                description={card.description}
                button={card.button}
                color={card.color}
              />
            ))
          }
        </div>
      </div>
    </section>
    <!-- Footer Components -->
    <Footer />
  </section>
</Layout>

<script>
  // Obtener elementos del DOM con verificación de null
  const track = document.getElementById("carousel-track");
  const prevBtn = document.getElementById("carousel-prev");
  const nextBtn = document.getElementById("carousel-next");
  const dotsContainer = document.getElementById("carousel-dots");

  // Verificar que todos los elementos existen antes de continuar
  if (!track || !prevBtn || !nextBtn || !dotsContainer) {
    console.error("Carousel: Required elements not found");
  } else {
    // Variables de estado
    let currentIndex = 0;
    let cardsPerView = 1;
    let totalCards = 0;
    let maxIndex = 0;

    function calculateCardsPerView() {
      const width = window.innerWidth;
      if (width >= 1024) return 3; // lg
      if (width >= 768) return 2; // md
      return 1; // mobile
    }

    function updateCarousel() {
      if (!track) return;

      cardsPerView = calculateCardsPerView();
      totalCards = track.children.length;
      maxIndex = Math.max(0, totalCards - cardsPerView);

      // Ajustar currentIndex si es necesario
      currentIndex = Math.min(currentIndex, maxIndex);

      const firstCard = track.children[0];
      if (firstCard instanceof HTMLElement) {
        const cardWidth = firstCard.offsetWidth;
        const gap = 24; // 6 * 4px (gap-6 de Tailwind)
        const offset = -(currentIndex * (cardWidth + gap));

        track.style.transform = `translateX(${offset}px)`;
      }

      updateButtons();
      updateDots();
    }

    function updateButtons() {
      if (!prevBtn || !nextBtn) return;

      if (prevBtn instanceof HTMLButtonElement) {
        prevBtn.disabled = currentIndex === 0;
      }
      if (nextBtn instanceof HTMLButtonElement) {
        nextBtn.disabled = currentIndex >= maxIndex;
      }
    }

    function createDots() {
      if (!dotsContainer) return;

      dotsContainer.innerHTML = "";
      const numDots = maxIndex + 1;

      for (let i = 0; i < numDots; i++) {
        const dot = document.createElement("button");
        dot.className = `w-2 h-2 rounded-full transition-all ${
          i === currentIndex ? "bg-[#FF6B35] w-8" : "bg-gray-300"
        }`;
        dot.setAttribute("aria-label", `Ir a slide ${i + 1}`);
        dot.addEventListener("click", () => {
          currentIndex = i;
          updateCarousel();
        });
        dotsContainer.appendChild(dot);
      }
    }

    function updateDots() {
      if (!dotsContainer) return;

      const dots = dotsContainer.children;
      for (let i = 0; i < dots.length; i++) {
        const dot = dots[i];
        if (dot instanceof HTMLElement) {
          dot.className = `w-2 h-2 rounded-full transition-all ${
            i === currentIndex ? "bg-[#FF6B35] w-8" : "bg-gray-300"
          }`;
        }
      }
    }

    function next() {
      if (currentIndex < maxIndex) {
        currentIndex++;
        updateCarousel();
      }
    }

    function prev() {
      if (currentIndex > 0) {
        currentIndex--;
        updateCarousel();
      }
    }

    // Event Listeners
    if (prevBtn) prevBtn.addEventListener("click", prev);
    if (nextBtn) nextBtn.addEventListener("click", next);

    // Keyboard navigation
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") prev();
      if (e.key === "ArrowRight") next();
    });

    // Touch/Swipe support
    let touchStartX = 0;
    let touchEndX = 0;

    if (track) {
      track.addEventListener("touchstart", (e) => {
        touchStartX = e.changedTouches[0].screenX;
      });

      track.addEventListener("touchend", (e) => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
      });
    }

    function handleSwipe() {
      const swipeThreshold = 50;
      if (touchStartX - touchEndX > swipeThreshold) next();
      if (touchEndX - touchStartX > swipeThreshold) prev();
    }

    // Responsive handling
    window.addEventListener("resize", () => {
      updateCarousel();
      createDots();
    });

    // Initialize
    updateCarousel();
    createDots();
  }
</script>

<style>
  /* Asegurar que el track no se rompa */
  #carousel-track {
    will-change: transform;
  }
</style>
