---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/Navbar.astro";
import { Image } from "astro:assets";
import HeadersSection from "../components/headersSection.astro";
import abstract from "../assets/abstract.svg";
import Footer from "../components/Footer.astro";
import contactCardsContent from "../data/contactCardsContent.js";
import ContactCards from "../components/contactCards.astro";
import WhatsCard from "../components/whatsCard.astro";
---

<Layout>
  <Navbar />

  <!-- Hero Contact Section -->
  <section id="informacion" class="p-5 opacity-0 animate-fade-in">
    <div class="max-w-7xl mx-auto">
      <div
        class="border-2 border-black rounded-xl p-8 w-full flex flex-col gap-4 relative lg:flex-row lg:p-12 lg:gap-8 hover:shadow-2xl transition-all duration-300"
      >
        <figure class="absolute top-0 left-0 animate-float">
          <Image
            src={abstract}
            alt={"Colegio de EducaciÃ³n por Ciclos de Oriente"}
            class="w-24 h-24 lg:w-32 lg:h-32"
          />
        </figure>

        <div
          class="flex flex-col gap-4 pt-12 lg:pt-0 lg:min-w-[280px] lg:max-w-[320px] lg:pl-8 scroll-reveal"
        >
          <HeadersSection text="ContÃ¡ctanos" />
          <h2
            class="font-medium text-[#262626] text-center text-2xl lg:text-3xl xl:text-4xl lg:text-left leading-tight"
          >
            No dudes en ponerte en contacto con nosotros.
          </h2>
        </div>

        <div
          class="lg:flex-1 lg:flex lg:items-center lg:pl-8 lg:border-l-2 lg:border-gray-200 scroll-reveal"
          style="animation-delay: 200ms"
        >
          <div>
            <p
              class="text-[#333333] text-center font-medium text-base lg:text-lg xl:text-xl lg:text-left lg:leading-relaxed"
            >
              Valoramos la comunicaciÃ³n abierta y estamos listos para asistirte
              con cualquier consulta. Si tienes preguntas sobre el proceso de
              validaciÃ³n, horarios o costos, no dudes en comunicarte con
              nosotros a travÃ©s de cualquiera de los siguientes mÃ©todos de
              contacto
            </p>
            <div class="grid gap-5 pt-5 grid-cols-1 sm:grid-cols-2">
              {
                contactCardsContent.map((card, index) => (
                  <div
                    class="scroll-reveal"
                    style={`animation-delay: ${(index + 3) * 100}ms`}
                  >
                    <ContactCards icon={card.icon} text={card.text} />
                  </div>
                ))
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Form Section -->
  <section
    id="formulario"
    class="p-5 lg:p-10 flex flex-col gap-5 items-center justify-center scroll-reveal"
  >
    <div class="max-w-7xl mx-auto w-full flex flex-col gap-5 items-center">
      <HeadersSection text="ContÃ¡ctanos" />
      <h2 class="text-3xl lg:text-4xl xl:text-5xl font-bold text-center">
        Formulario de InterÃ©s
      </h2>
      <p
        class="text-[#333333] text-center font-medium text-lg lg:text-lg xl:text-xl lg:w-[80%] xl:w-[70%]"
      >
        Si tienes preguntas especÃ­ficas o deseas solicitar mÃ¡s informaciÃ³n sobre
        nuestro programa de ValidaciÃ³n de Bachillerato, por favor, completa el
        siguiente formulario de contacto. Te agradecemos que nos brindes estos
        detalles para entender mejor tus necesidades.
      </p>

      <!-- Mensaje de estado -->
      <div
        id="form-message"
        class="hidden w-full text-center p-4 rounded-lg font-semibold text-lg"
      >
      </div>

      <!-- Form Container -->
      <div
        class="p-8 lg:p-10 border-[#262626] border-2 rounded-xl w-full hover:shadow-2xl transition-all duration-300 scroll-reveal"
        style="animation-delay: 200ms"
      >
        <form
          id="contact-form"
          action="https://api.web3forms.com/submit"
          method="POST"
          class="flex flex-col gap-6 lg:grid lg:grid-cols-2 lg:gap-8"
        >
          <!-- Access Key de Web3Forms - REEMPLAZAR CON TU KEY -->
          <input
            type="hidden"
            name="access_key"
            value="e7b95396-331d-4be9-b4f1-758a35f9ff33"
          />

          <!-- ConfiguraciÃ³n adicional -->
          <input
            type="hidden"
            name="subject"
            value="Nuevo contacto - ValidaciÃ³n Bachillerato"
          />
          <input
            type="hidden"
            name="from_name"
            value="Colegio de EducaciÃ³n por Ciclos"
          />

          <!-- Honeypot anti-spam -->
          <input
            type="checkbox"
            name="botcheck"
            class="hidden"
            style="display: none;"
          />

          <div
            class="flex flex-col gap-3 scroll-reveal"
            style="animation-delay: 300ms"
          >
            <label
              for="nombre-interesado"
              class="font-semibold text-[#4C4C4C] text-lg lg:text-xl"
            >
              Nombre del Interesado
            </label>
            <input
              id="nombre-interesado"
              name="nombre_interesado"
              class="border-2 border-[#262626] p-3 rounded-lg font-medium text-[#59595A] bg-[#FFFCFA] lg:p-4 focus:border-[#8CC63F] focus:ring-2 focus:ring-[#8CC63F] focus:outline-none transition-all duration-300 hover:shadow-md"
              type="text"
              placeholder="Ingresa tu Nombre Completo"
              required
            />
          </div>

          <div
            class="flex flex-col gap-3 scroll-reveal"
            style="animation-delay: 350ms"
          >
            <label
              class="font-semibold text-[#4C4C4C] text-lg lg:text-xl"
              for="correo"
            >
              Correo ElectrÃ³nico
            </label>
            <input
              id="correo"
              name="email"
              class="border-2 border-[#262626] p-3 rounded-lg font-medium text-[#59595A] bg-[#FFFCFA] lg:p-4 focus:border-[#8CC63F] focus:ring-2 focus:ring-[#8CC63F] focus:outline-none transition-all duration-300 hover:shadow-md"
              type="email"
              placeholder="Ingresa tu Correo ElectrÃ³nico"
              required
            />
          </div>

          <div
            class="flex flex-col gap-3 scroll-reveal"
            style="animation-delay: 400ms"
          >
            <label
              class="font-semibold text-[#4C4C4C] text-lg lg:text-xl"
              for="telefono"
            >
              NÃºmero de Contacto
            </label>
            <input
              id="telefono"
              name="telefono"
              class="border-2 border-[#262626] p-3 rounded-lg font-medium text-[#59595A] bg-[#FFFCFA] lg:p-4 focus:border-[#8CC63F] focus:ring-2 focus:ring-[#8CC63F] focus:outline-none transition-all duration-300 hover:shadow-md"
              type="tel"
              placeholder="Ingresa tu NÃºmero de TelÃ©fono"
              required
            />
          </div>

          <div
            class="flex flex-col gap-3 scroll-reveal"
            style="animation-delay: 450ms"
          >
            <label
              class="font-semibold text-[#4C4C4C] text-lg lg:text-xl"
              for="nombre-estudiante"
            >
              Nombre del Estudiante
            </label>
            <input
              id="nombre-estudiante"
              name="nombre_estudiante"
              class="border-2 border-[#262626] p-3 rounded-lg font-medium text-[#59595A] bg-[#FFFCFA] lg:p-4 focus:border-[#8CC63F] focus:ring-2 focus:ring-[#8CC63F] focus:outline-none transition-all duration-300 hover:shadow-md"
              type="text"
              placeholder="Ingresa el nombre de la persona que va a estudiar"
              required
            />
          </div>

          <div
            class="flex flex-col gap-3 scroll-reveal"
            style="animation-delay: 500ms"
          >
            <label
              class="font-semibold text-[#4C4C4C] text-lg lg:text-xl"
              for="edad"
            >
              Edad
            </label>
            <input
              id="edad"
              name="edad"
              class="border-2 border-[#262626] p-3 rounded-lg font-medium text-[#59595A] bg-[#FFFCFA] lg:p-4 focus:border-[#8CC63F] focus:ring-2 focus:ring-[#8CC63F] focus:outline-none transition-all duration-300 hover:shadow-md"
              type="number"
              min="10"
              max="99"
              placeholder="Ingresa tu Edad"
              required
            />
          </div>

          <div
            class="flex flex-col gap-3 scroll-reveal"
            style="animation-delay: 550ms"
          >
            <label
              class="font-semibold text-[#4C4C4C] text-lg lg:text-xl"
              for="ciclo"
            >
              Grado o Ciclo a Validar
            </label>
            <select
              id="ciclo"
              name="ciclo"
              class="border-2 border-[#262626] p-3 rounded-lg font-medium text-[#59595A] bg-[#FFFCFA] cursor-pointer lg:p-4 focus:border-[#8CC63F] focus:ring-2 focus:ring-[#8CC63F] focus:outline-none transition-all duration-300 hover:shadow-md"
              required
            >
              <option value="" disabled selected
                >Selecciona el Ciclo que te interesa</option
              >
              <option value="ciclo-1">Ciclo I - Grados 6Â° y 7Â°</option>
              <option value="ciclo-2">Ciclo II - Grados 8Â° y 9Â°</option>
              <option value="ciclo-3">Ciclo III - Grados 10Â° y 11Â°</option>
            </select>
          </div>

          <div
            class="flex flex-col gap-3 lg:col-span-2 scroll-reveal"
            style="animation-delay: 600ms"
          >
            <label
              class="font-semibold text-[#4C4C4C] text-lg lg:text-xl"
              for="mensaje"
            >
              Mensaje
            </label>
            <textarea
              id="mensaje"
              name="mensaje"
              class="border-2 border-[#262626] p-3 rounded-lg font-medium text-[#59595A] bg-[#FFFCFA] min-h-[120px] resize-y lg:p-4 focus:border-[#8CC63F] focus:ring-2 focus:ring-[#8CC63F] focus:outline-none transition-all duration-300 hover:shadow-md"
              placeholder="Ingresa tu Mensaje (Ej: Â¿CuÃ¡ndo inician las clases?)"
              rows="4"></textarea>
          </div>

          <button
            id="submit-btn"
            class="bg-[#8CC63F] p-4 flex items-center justify-center text-xl lg:text-2xl text-[#262626] font-bold w-full rounded-xl hover:bg-[#7AB52F] hover:scale-105 transition-all duration-300 lg:col-span-2 cursor-pointer shadow-lg hover:shadow-xl scroll-reveal disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100"
            style="animation-delay: 650ms"
            type="submit"
          >
            <span id="btn-text">Enviar Solicitud</span>
            <span id="btn-loading" class="hidden">Enviando...</span>
          </button>
        </form>
      </div>
    </div>
  </section>

  <Footer />
  <WhatsCard />
</Layout>

<script>
  // Intersection Observer para animaciones al hacer scroll
  const observerOptions = {
    threshold: 0.1,
    rootMargin: "0px 0px -50px 0px",
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add("is-visible");
      }
    });
  }, observerOptions);

  document.querySelectorAll(".scroll-reveal").forEach((el) => {
    observer.observe(el);
  });

  // Manejo del formulario con Web3Forms
  const form = document.getElementById("contact-form") as HTMLFormElement;
  const formMessage = document.getElementById("form-message") as HTMLDivElement;
  const submitBtn = document.getElementById("submit-btn") as HTMLButtonElement;
  const btnText = document.getElementById("btn-text") as HTMLSpanElement;
  const btnLoading = document.getElementById("btn-loading") as HTMLSpanElement;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // Mostrar estado de carga
    btnText.classList.add("hidden");
    btnLoading.classList.remove("hidden");
    submitBtn.disabled = true;

    const formData = new FormData(form);
    const object = Object.fromEntries(formData);
    const json = JSON.stringify(object);

    try {
      const response = await fetch("https://api.web3forms.com/submit", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Accept: "application/json",
        },
        body: json,
      });

      const result = await response.json();

      if (result.success) {
        // Mostrar mensaje de Ã©xito
        formMessage.textContent =
          "Â¡Mensaje enviado exitosamente! Te contactaremos pronto. ðŸŽ‰";
        formMessage.className =
          "w-full text-center p-4 rounded-lg font-semibold text-lg bg-green-100 border-2 border-green-500 text-green-700";
        formMessage.classList.remove("hidden");

        // Limpiar el formulario
        form.reset();

        // Scroll al mensaje de Ã©xito
        formMessage.scrollIntoView({ behavior: "smooth", block: "center" });
      } else {
        throw new Error(result.message || "Error al enviar el formulario");
      }
    } catch (error) {
      // Mostrar mensaje de error
      formMessage.textContent =
        "Hubo un error al enviar el mensaje. Por favor intenta nuevamente o contÃ¡ctanos directamente.";
      formMessage.className =
        "w-full text-center p-4 rounded-lg font-semibold text-lg bg-red-100 border-2 border-red-500 text-red-700";
      formMessage.classList.remove("hidden");

      console.error("Error:", error);
    } finally {
      // Restaurar el botÃ³n
      btnText.classList.remove("hidden");
      btnLoading.classList.add("hidden");
      submitBtn.disabled = false;

      // Ocultar mensaje despuÃ©s de 8 segundos
      setTimeout(() => {
        formMessage.classList.add("hidden");
      }, 8000);
    }
  });
</script>

<style>
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fadeIn 1s ease-out forwards;
  }

  @keyframes float {
    0%,
    100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-10px);
    }
  }

  .animate-float {
    animation: float 3s ease-in-out infinite;
  }

  .scroll-reveal {
    opacity: 0;
    transform: translateY(50px);
    transition:
      opacity 0.8s ease-out,
      transform 0.8s ease-out;
  }

  .scroll-reveal.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  html {
    scroll-behavior: smooth;
  }

  select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23262626' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    padding-right: 2.5rem;
  }
</style>
